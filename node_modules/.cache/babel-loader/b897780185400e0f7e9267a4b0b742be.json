{"ast":null,"code":"import _toConsumableArray from\"/root/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/root/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/root/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from'react';import{useHistory,useParams}from'react-router-dom';import{Preview}from'../components/Preview';import{Message}from'../components/Message';import{MessageBox}from'../components/MessageBox';import'./RoomFriend.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Room=function Room(props){/*\n    const socket = new WebSocket(\"ws://localhost:8000/ws/\")\n    const socketRef = useRef();\n    socketRef.current = socket;\n    */var socket=useRef(null);var history=useHistory();var _useState=useState(),_useState2=_slicedToArray(_useState,2),msg=_useState2[0],setMsg=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];// get room id\nvar router_data=useParams();var room_id=router_data['room_id'];props.setRoomID(room_id);if(!localStorage.getItem(\"user\")){history.push('/login');}useEffect(function(){var getMessages=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"http://\".concat(process.env.REACT_APP_SERVER_URL,\"/api/get-messages\"),{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({room_id:room_id})});case 2:response=_context.sent;_context.next=5;return response.json();case 5:result=_context.sent;setMessages(result['messages']);case 7:case\"end\":return _context.stop();}}},_callee);}));return function getMessages(){return _ref.apply(this,arguments);};}();getMessages();socket.current=new WebSocket(\"ws://\".concat(process.env.REACT_APP_SERVER_URL,\"/ws/\")+room_id);socket.current.onopen=function(event){console.log(\"Connection at: \",room_id);};socket.current.onmessage=function(msg){var new_msg=JSON.parse(msg.data);console.log(new_msg);setMessages(function(prev){return[].concat(_toConsumableArray(prev),[new_msg]);});};socket.current.onclose=function(event){console.log(\"socket closed connection: \",event);};},[room_id]);var sendMsg=function sendMsg(){return socket.current.send(msg);};return/*#__PURE__*/_jsxs(\"div\",{className:\"container room-friend-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"row mt-5\",children:/*#__PURE__*/_jsx(Preview,{alt:\"room\",size:\"img-large\",isRoom:true,room_id:room_id,overlay:false})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:messages.length===0?null:Object.keys(messages).map(function(key){return/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsx(Message,{user:messages[key]['user'],text:messages[key]['text'],isCurrUser:props.user['username']===messages[key]['user']})},key);})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(MessageBox,{onChange:setMsg,onClick:sendMsg})})]});};","map":{"version":3,"sources":["/root/client/src/pages/Room.js"],"names":["React","useEffect","useState","useRef","useHistory","useParams","Preview","Message","MessageBox","Room","props","socket","history","msg","setMsg","messages","setMessages","router_data","room_id","setRoomID","localStorage","getItem","push","getMessages","fetch","process","env","REACT_APP_SERVER_URL","method","headers","credentials","body","JSON","stringify","response","json","result","current","WebSocket","onopen","event","console","log","onmessage","new_msg","parse","data","prev","onclose","sendMsg","send","length","Object","keys","map","key","user"],"mappings":"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","sourcesContent":["import React, {useEffect, useState, useRef} from 'react'\nimport {useHistory, useParams} from 'react-router-dom'\nimport {Preview} from '../components/Preview'\nimport {Message} from '../components/Message'\nimport {MessageBox} from '../components/MessageBox'\nimport './RoomFriend.scss'\n\nexport const Room = (props) => {\n    /*\n    const socket = new WebSocket(\"ws://localhost:8000/ws/\")\n    const socketRef = useRef();\n    socketRef.current = socket;\n    */\n    const socket = useRef(null);\n\n    const history = useHistory()\n    const [msg, setMsg] = useState()\n    const [messages, setMessages] = useState('')\n    // get room id\n    let router_data = useParams()\n    let room_id = router_data['room_id']\n    props.setRoomID(room_id)\n\n    if (!localStorage.getItem(\"user\")) {\n        history.push('/login')\n    }\n\n    useEffect(() => {\n        const getMessages = async() => {\n            const response = await fetch(`http://${process.env.REACT_APP_SERVER_URL}/api/get-messages`, {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                credentials: 'include',\n                body: JSON.stringify({\n                    room_id: room_id\n                })\n            })\n\n            const result = await response.json()\n            setMessages(result['messages']) \n        }\n        \n        getMessages()\n\n        \n        socket.current = new WebSocket(`ws://${process.env.REACT_APP_SERVER_URL}/ws/`+room_id)\n        socket.current.onopen = (event) => {\n            console.log(\"Connection at: \", room_id)\n        }\n        socket.current.onmessage = (msg) => {\n            let new_msg = JSON.parse(msg.data)\n            console.log(new_msg)\n            setMessages(prev => [...prev, new_msg])\n        }\n        socket.current.onclose = (event) => {\n            console.log(\"socket closed connection: \", event)\n        }\n    }, [room_id])\n\n\n    const sendMsg = () => socket.current.send(msg)\n\n    return (\n        <div className='container room-friend-container'>\n            <div className='row mt-5'>\n                <Preview alt='room' size='img-large' isRoom={true} room_id={room_id} overlay={false} />\n            </div>\n            <div className='row'>\n                {messages.length === 0 ? null : Object.keys(messages).map(key => \n                    <div key={key} className=''>\n                        <Message user={messages[key]['user']} text={messages[key]['text']} isCurrUser={props.user['username'] === messages[key]['user']} />\n                    </div>\n                )}\n            </div>\n\n            <div className='row'>\n                <MessageBox onChange={setMsg} onClick={sendMsg}/>\n            </div>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}